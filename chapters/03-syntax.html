<!DOCTYPE HTML>
<!--
Prologue by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
Jekyll integration by Chris Bobbe | chrisbobbe.github.io
-->
<html><head><!-- Robots -->
  <meta name="robots" content="index, follow" /><link rel="canonical" href="/introducing-crystal/chapters/03-syntax.html" /><!-- Title, description, author --><title>03. 構文 | Introducing Crystal Programming Language</title>
  <meta name="description" content="『Introducing Crystal Programming Language』はプログラミング言語 Crystal の初心者〜中級者向け解説書です。" />
  <meta name="author" content="Crystal-JP" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="03. 構文 | Introducing Crystal Programming Language" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/introducing-crystal/assets/images/avatar.png" />
  <meta property="og:url" content="/introducing-crystal/chapters/03-syntax.html" />
  <meta property="og:site_name" content="Introducing Crystal Programming Language" />
  <meta property="og:description" content="『Introducing Crystal Programming Language』はプログラミング言語 Crystal の初心者〜中級者向け解説書です。" />
  
  <!-- Styles -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!--[if lte IE 8]><script src="/introducing-crystal/assets/js/ie/html5shiv.js" defer></script><![endif]-->
  <link rel="stylesheet" href="/introducing-crystal/assets/css/main.css" />
  <!--[if lte IE 8]><link rel="stylesheet" href="/introducing-crystal/assets/css/ie8.css" /><![endif]-->
  <!--[if lte IE 9]><link rel="stylesheet" href="/introducing-crystal/assets/css/ie9.css" /><![endif]-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" defer></script>
  <script src="/introducing-crystal/assets/js/jquery.scrolly.min.js" defer></script>
  <script src="/introducing-crystal/assets/js/jquery.scrollzer.min.js" defer></script>
  <script src="/introducing-crystal/assets/js/skel.min.js" defer></script>
  <script src="/introducing-crystal/assets/js/util.js" defer></script>
  <!--[if lte IE 8]><script src="/introducing-crystal/assets/js/ie/respond.min.js" defer></script><![endif]-->
  <script src="/introducing-crystal/assets/js/main.js" defer></script>

</head><body><!-- Header -->
<div id="header">
  <div class="top"><!-- Logo -->
<div id="logo">
  <a href="/introducing-crystal/" id="home-link">
    <span class="image avatar48"><img src="/introducing-crystal/assets/images/avatar.png" alt="Avatar of Crystal-JP" /></span>
    <h1 id="title">Introducing Crystal Programming Language</h1>
    <p></p>
  </a>
</div><!-- Nav -->
<nav id="nav">
  <ul><li><a href="/introducing-crystal/" id="トップページ-link">
            <span class="icon fa-link">トップページ</span>
          </a></li><li><a href="/introducing-crystal/chapters/01-introduction.html" id="01-はじめに-link">
            <span class="icon fa-link">01. はじめに</span>
          </a></li><li><a href="/introducing-crystal/chapters/02-getting-started.html" id="02-getting-started-link">
            <span class="icon fa-link">02. Getting Started</span>
          </a></li><li><a href="#" id="03-構文" class="active">
            <span class="icon fa-link">03. 構文</span>
          </a></li><li><a href="/introducing-crystal/chapters/06-web-development.html" id="06-web-開発-link">
            <span class="icon fa-link">06. Web 開発</span>
          </a></li><li><a href="/introducing-crystal/chapters/04-macro.html" id="04-マクロ-link">
            <span class="icon fa-link">04. マクロ</span>
          </a></li><li><a href="/introducing-crystal/chapters/07-cli-development.html" id="07-cli-開発-link">
            <span class="icon fa-link">07. CLI 開発</span>
          </a></li><li><a href="/introducing-crystal/chapters/05-shards.html" id="05-shards-link">
            <span class="icon fa-link">05. Shards</span>
          </a></li><li><a href="/introducing-crystal/authors.html" id="著者紹介-link">
            <span class="icon fa-link">著者紹介</span>
          </a></li></ul>
</nav></div>
  <div class="bottom"><!-- Social Icons -->
<ul class="icons"></ul>
</div>
</div>
<!-- Main -->
<div id="main">
	<!-- Page -->
	<article class="shade-two">
	  <div class="container">
			<header>
				<h2>03. 構文</h2></header><div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#crystal-と-ruby-の違い">Crystal と Ruby の違い</a></li>
<li><a href="#型システム">型システム</a></li>
<li><a href="#typeof"><code>typeof</code></a></li>
<li><a href="#リテラル">リテラル</a>
<ul class="sectlevel2">
<li><a href="#数値リテラルの型指定">数値リテラルの型指定</a></li>
<li><a href="#空の配列と空のハッシュに対する型指定">空の配列と空のハッシュに対する型指定</a></li>
<li><a href="#タプルと名前付きタプル">タプルと名前付きタプル</a></li>
</ul>
</li>
<li><a href="#変数">変数</a></li>
<li><a href="#クラスメソッド">クラス・メソッド</a>
<ul class="sectlevel2">
<li><a href="#メソッドの型指定オーバーロード-previous_def">メソッドの型指定・オーバーロード・ <code>previous_def</code></a></li>
<li><a href="#名前付き引数">名前付き引数</a></li>
<li><a href="#可変長引数">可変長引数</a></li>
<li><a href="#インスタンス変数の型">インスタンス変数の型</a></li>
<li><a href="#struct"><code>struct</code></a></li>
</ul>
</li>
<li><a href="#enum"><code>enum</code></a></li>
<li><a href="#メソッド呼び出し">メソッド呼び出し</a></li>
<li><a href="#条件分岐繰り返し">条件分岐・繰り返し</a></li>
<li><a href="#まとめ">まとめ</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>この章では Crystal の構文について説明します。</p>
</div>
<div class="paragraph">
<p>Crystal の構文を全て説明すると膨大になってしまうので、ここでは Ruby との違いに焦点を置いて解説したいと思います。<br>
というのも、 Crystal の構文は Ruby の影響を強く受けており、多くの場合 Ruby のように書くことで Crystal のプログラムを書くことができます。<br>
しかし、やはり Crystal と Ruby は別のプログラミング言語であり、構文の異なる部分もいくつか存在します。<br>
既に知識があるのであれば、その違いを抑えていくのが Crystal の構文を理解する手助けになるでしょう。</p>
</div>
<div class="paragraph">
<p>Ruby の構文については次のサイトを参考にしてください。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">オブジェクト指向スクリプト言語 Ruby リファレンスマニュアル </dt>
<dd>
<p><a href="https://docs.ruby-lang.org/ja/latest/doc/index.html" class="bare">https://docs.ruby-lang.org/ja/latest/doc/index.html</a></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>また、Crystal の完全な構文は、公式サイトにある次のドキュメントを参考にしてください。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Syntax and Semantics </dt>
<dd>
<p><a href="https://crystal-lang.org/docs/syntax_and_semantics/" class="bare">https://crystal-lang.org/docs/syntax_and_semantics/</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crystal-と-ruby-の違い">Crystal と Ruby の違い</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Crystal と Ruby は構文こそよく似ていますが、言語としては次のような大きな違いがあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ruby はインタープリタで実行されるが、 Crystal はコンパイルして実行する。</p>
</li>
<li>
<p>Ruby には変数に型が無いが、 Crystal には型がある。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>そして、この2が Crystal と Ruby の構文に違いをもたらしています。</p>
</div>
<div class="paragraph">
<p>前者を実感する例としては、こんなものがあります。<br>
これは有効な Ruby のプログラムですが、 Crystal ではコンパイルエラーになります。</p>
</div>
<div class="paragraph">
<p>Crystal は <code>require</code> で読み込むファイルまで含めてコンパイルしなければなりません。<br>
なので <code>require</code> は Ruby のようなメソッドではなく、構文として提供されていて、引数は固定の文字列ではなければいけないのです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-ruby" data-lang="ruby"><span id="L1" class="line"><span style="color: #505050"># Ruby のプログラム！</span></span>
<span id="L2" class="line"></span>
<span id="L3" class="line"><span style="color: #f4bf75">Dir</span><span style="color: #d0d0d0">[</span><span style="color: #90a959">"foo/*.rb"</span><span style="color: #d0d0d0">].</span><span style="color: #303030">each</span> <span style="color: #aa759f">do</span> <span style="color: #d0d0d0">|</span><span style="color: #303030">file</span><span style="color: #d0d0d0">|</span></span>
<span id="L4" class="line">  <span style="color: #303030">require</span> <span style="color: #303030">file</span></span>
<span id="L5" class="line"><span style="color: #aa759f">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>後者を実感する例としては、こんなものがあります。<br>
これは Crystal のプログラムです。</p>
</div>
<div class="paragraph">
<p>メソッドの引数に型を指定しているところに注目してください。<br>
引数の型でメソッドをオーバーロードすることができます。<br>
これは Ruby ではできません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># Crystal のプログラム！</span></span>
<span id="L2" class="line"></span>
<span id="L3" class="line"><span style="color: #505050"># `foo` の引数が `String` の場合のメソッド</span></span>
<span id="L4" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">foo</span><span style="color: #d0d0d0">(</span><span style="color: #303030">x</span> <span style="color: #d0d0d0">:</span> <span style="color: #f4bf75">String</span><span style="color: #d0d0d0">)</span></span>
<span id="L5" class="line">  <span style="color: #303030">p</span> <span style="color: #90a959">:string</span></span>
<span id="L6" class="line"><span style="color: #aa759f">end</span></span>
<span id="L7" class="line"></span>
<span id="L8" class="line"><span style="color: #505050"># `foo` の引数が `Int32` （数値）の場合のメソッド</span></span>
<span id="L9" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">foo</span><span style="color: #d0d0d0">(</span><span style="color: #303030">x</span> <span style="color: #d0d0d0">:</span> <span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">)</span></span>
<span id="L10" class="line">  <span style="color: #303030">p</span> <span style="color: #90a959">:int32</span></span>
<span id="L11" class="line"><span style="color: #aa759f">end</span></span>
<span id="L12" class="line"></span>
<span id="L13" class="line"><span style="color: #505050"># 呼び出し時に引数の型によって適切なものが選択される</span></span>
<span id="L14" class="line"><span style="color: #303030">foo</span> <span style="color: #90a959">"string"</span></span>
<span id="L15" class="line"><span style="color: #303030">foo</span> <span style="color: #90a959">42</span></span>
<span id="L16" class="line"></span>
<span id="L17" class="line"><span style="color: #505050"># output:</span></span>
<span id="L18" class="line"><span style="color: #505050"># :string</span></span>
<span id="L19" class="line"><span style="color: #505050"># :int32</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>それでは、 Crystal と Ruby で構文の異なる部分を説明していきます。</p>
</div>
<div class="paragraph">
<p>これらの違いを意識しながら読み進めていってください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="型システム">型システム</h2>
<div class="sectionbody">
<div class="paragraph">
<p>はじめに Crystal の型システムについて簡単に説明しておきます。</p>
</div>
<div class="paragraph">
<p>Crystal の型には次のようなものがあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通常の型</p>
<div class="ulist">
<ul>
<li>
<p><code>Int32</code> （整数）や <code>String</code> （文字列）、 <code>Nil</code> 、 <code>Bool</code> など</p>
</li>
</ul>
</div>
</li>
<li>
<p>ジェネリックス</p>
<div class="ulist">
<ul>
<li>
<p><code>Array(Int32)</code> （要素の型が <code>Int32</code> の配列）</p>
</li>
<li>
<p><code>Array(String)</code> （要素の型が <code>String</code> の配列）</p>
</li>
<li>
<p><code>Hash(String, Int32)</code> （キーの型が <code>String</code> で値の型が <code>Int32</code> のハッシュ）</p>
</li>
</ul>
</div>
</li>
<li>
<p>ユニオン</p>
<div class="ulist">
<ul>
<li>
<p><code>Int32 | String</code> （ <code>Int32</code> か <code>String</code> 型）</p>
</li>
<li>
<p><code>Int32?</code> （ <code>Int32 | Nil</code> の糖衣構文）</p>
</li>
</ul>
</div>
</li>
<li>
<p>Proc</p>
<div class="ulist">
<ul>
<li>
<p><code>Int32 &#8594; String</code> （引数に <code>Int32</code> を受け取って <code>String</code> を返す Proc）</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>こんなものがあるんだな、となんとなく覚えておいてください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="typeof"><code>typeof</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ruby には無い構文として <code>typeof</code> というものが Crystal にはあります。</p>
</div>
<div class="paragraph">
<p>これは引数として与えられた式の結果についた型を返す構文です。<br>
引数の式はコンパイル時にのみ利用され、実行時には利用されないことに注意してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 文字列リテラルの型は `String`</span></span>
<span id="L2" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">"foo"</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; String</span></span>
<span id="L3" class="line"></span>
<span id="L4" class="line"><span style="color: #505050"># 引数の式は実行されない</span></span>
<span id="L5" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #303030">puts</span> <span style="color: #90a959">"hello"</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Nil</span></span>
<span id="L6" class="line"><span style="color: #505050"># hello とは出力されない</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="リテラル">リテラル</h2>
<div class="sectionbody">
<div class="paragraph">
<p>リテラル関連で Ruby と大きく異なるところは、次のものが挙げられます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数値リテラルの型指定</p>
</li>
<li>
<p>空の配列と空のハッシュに対する型指定</p>
</li>
<li>
<p>タプルと名前付きタプル</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>逆に、これ以外は一部の例外を除いて Ruby と同じように書くことができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>一部の例外としては次のものが挙げられます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>いくつかの <code>%</code> 形式のリテラル（ <code>%s</code> や <code>%W</code> など）が存在しない。</p>
</li>
<li>
<p>ハッシュの <code>{foo: bar}</code> のような形式は名前付きタプルの構文となっている。</p>
</li>
<li>
<p>正規表現の構文がPCREになっている。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="数値リテラルの型指定">数値リテラルの型指定</h3>
<div class="paragraph">
<p>Ruby の数値は基本的には <code>Integer</code> と <code>Float</code> だけです。<br>
しかし、Crystal の数値はその大きさや符号の有無によって <code>Int32</code> ・ <code>Int64</code> ・ <code>UInt32</code> ・ <code>Float32</code> ・ <code>Float64</code> などが存在します。<br>
<code>Int32</code> は32ビットの符号付き整数型で、 <code>UInt32</code> は32ビットの符号無し整数型、 <code>Float64</code> は64ビットの浮動小数点型です。<br>
そして、数値リテラルの末尾に <code>i32</code> ・ <code>i64</code> ・ <code>f32</code> ・ <code>f64</code> などと付けることによって、値の型を指定できます。</p>
</div>
<div class="paragraph">
<p>もちろん数値リテラルの末尾に何も指定しないことも可能で、その場合は整数なら <code>Int32</code> 型、小数なら <code>Float64</code> 型になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 何も指定していない数値は `Int32` 、 `Float64` 型</span></span>
<span id="L2" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #d0d0d0">)</span>  <span style="color: #505050"># =&gt; Int32</span></span>
<span id="L3" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">3.14</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Float64</span></span>
<span id="L4" class="line"></span>
<span id="L5" class="line"><span style="color: #505050"># 符号付き整数型</span></span>
<span id="L6" class="line"><span style="color: #d0d0d0">[</span><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">i8</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">i16</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">i32</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">i64</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">i128</span><span style="color: #d0d0d0">)]</span></span>
<span id="L7" class="line"><span style="color: #505050"># =&gt; [Int8, Int16, Int32, Int64, Int128]</span></span>
<span id="L8" class="line"></span>
<span id="L9" class="line"><span style="color: #505050"># 符号無し整数型</span></span>
<span id="L10" class="line"><span style="color: #d0d0d0">[</span><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">u8</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">u16</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">u32</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">u64</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">123</span><span style="color: #303030">u128</span><span style="color: #d0d0d0">)]</span></span>
<span id="L11" class="line"><span style="color: #505050"># =&gt; [UInt8, UInt16, UInt32, UInt64, UInt128]</span></span>
<span id="L12" class="line"></span>
<span id="L13" class="line"><span style="color: #505050"># 浮動小数点型</span></span>
<span id="L14" class="line"><span style="color: #d0d0d0">[</span><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">3.14</span><span style="color: #303030">f32</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">3.14</span><span style="color: #303030">f64</span><span style="color: #d0d0d0">)]</span> <span style="color: #505050"># =&gt; [Float32, Float64]</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="空の配列と空のハッシュに対する型指定">空の配列と空のハッシュに対する型指定</h3>
<div class="paragraph">
<p>空の配列は <code>[]</code> 、空のハッシュは <code>{}</code> のように書けますが、これだと要素やキーの型が分からないためコンパイルすることができません。<br>
そこで Crystal では、空のリテラルに <code>of 型</code> と続けることで型を指定します。<br>
ハッシュの場合は <code>of キーの型 &#8658; 値の型</code> になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 要素の型が `Int32` の空の配列を作成</span></span>
<span id="L2" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">([]</span> <span style="color: #aa759f">of</span> <span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Array(Int32)</span></span>
<span id="L3" class="line"></span>
<span id="L4" class="line"><span style="color: #505050"># キーの型が `String` 、要素の型が `Int32` の空のハッシュを作成</span></span>
<span id="L5" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">({}</span> <span style="color: #aa759f">of</span> <span style="color: #f4bf75">String</span> <span style="color: #d0d0d0">=&gt;</span> <span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Hash(String, Int32)</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="タプルと名前付きタプル">タプルと名前付きタプル</h3>
<div class="paragraph">
<p>これは可変長引数、名前付き引数と関連の深い概念なので、そこで説明します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="変数">変数</h2>
<div class="sectionbody">
<div class="paragraph">
<p>変数名は小文字から始めなければならず、定数は大文字から始めねけらばいけません。<br>
インスタンス変数は <code>@</code> から、クラス変数は <code>@@</code> から始めなければいけません。<br>
これらは Ruby と同様です。</p>
</div>
<div class="paragraph">
<p>しかし Crystal にグローバル変数はありません。<br>
代わりにクラス変数や定数を使ってください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="クラスメソッド">クラス・メソッド</h2>
<div class="sectionbody">
<div class="paragraph">
<p>クラス・メソッド関連で Ruby と大きく異なるところは、次のものが挙げられます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メソッドの型指定・オーバーロード・ <code>previous_def</code></p>
</li>
<li>
<p>名前付き引数</p>
</li>
<li>
<p>可変長引数の扱い</p>
</li>
<li>
<p>インスタンス変数の型</p>
</li>
<li>
<p><code>struct</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>また、 Crystal ではコンパイル時に全てのメソッドが定義されていなければいけません。<br>
なので Ruby の <code>define_method</code> のようなことはできません。</p>
</div>
<div class="sect2">
<h3 id="メソッドの型指定オーバーロード-previous_def">メソッドの型指定・オーバーロード・ <code>previous_def</code></h3>
<div class="paragraph">
<p>メソッドの型指定・オーバーロードは前述しましたが、異なる引数の型を持った同名のメソッドを定義すると、呼び出し時に適切なものが選択される、という機能です。</p>
</div>
<div class="paragraph">
<p>また、このときに引数の型が一致するメソッドが見つからなかった場合、コンパイルエラーになります。</p>
</div>
<div class="paragraph">
<p><code>previous_def</code> は反対に、一致するメソッドが複数見つかってしまった場合に使う機能です。<br>
この場合は、まず一番最後に定義されたものが呼び出されます。<br>
そして、その中で <code>previous_def</code> を使うと、次に定義されたものが呼び出されるのです。</p>
</div>
<div class="paragraph">
<p>ちなみに、引数の型は指定しないこともできます。<br>
その場合は任意の型を受け取ることになります。<br>
ですが、実際に呼び出された引数が持っていないメソッドを呼び出していた場合は、コンパイルエラーになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 最初に定義したもの</span></span>
<span id="L2" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">foo</span><span style="color: #d0d0d0">(</span><span style="color: #303030">x</span> <span style="color: #d0d0d0">:</span> <span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">)</span></span>
<span id="L3" class="line">  <span style="color: #90a959">1</span> <span style="color: #d0d0d0">+</span> <span style="color: #303030">x</span></span>
<span id="L4" class="line"><span style="color: #aa759f">end</span></span>
<span id="L5" class="line"></span>
<span id="L6" class="line"><span style="color: #505050"># 次に定義したもの</span></span>
<span id="L7" class="line"><span style="color: #505050"># こちらが呼ばれる</span></span>
<span id="L8" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">foo</span><span style="color: #d0d0d0">(</span><span style="color: #303030">x</span> <span style="color: #d0d0d0">:</span> <span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">)</span></span>
<span id="L9" class="line">  <span style="color: #303030">previous_def</span> <span style="color: #d0d0d0">+</span> <span style="color: #90a959">2</span> <span style="color: #505050"># ここの `previous_def` で上の `foo` が呼ばれる</span></span>
<span id="L10" class="line"><span style="color: #aa759f">end</span></span>
<span id="L11" class="line"></span>
<span id="L12" class="line"><span style="color: #303030">foo</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">3</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; 6</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="名前付き引数">名前付き引数</h3>
<div class="paragraph">
<p>名前付き引数とは、 Ruby ではキーワード引数と呼ばれるものです。</p>
</div>
<div class="paragraph">
<p>Crystal では、全ての引数を名前付き引数として呼び出すことができます。</p>
</div>
<div class="paragraph">
<p>他にも、名前付き引数として指定するための名前と、実際に引数として受け取る変数の名前を分けることができます。<br>
これは、名前付き引数の名前として予約語を使いたいときに便利です。</p>
</div>
<div class="paragraph">
<p>次のようなメソッドを定義した場合、</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 割り算をするメソッド</span></span>
<span id="L2" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">div</span><span style="color: #d0d0d0">(</span><span style="color: #303030">left</span><span style="color: #d0d0d0">,</span> <span style="color: #303030">right</span><span style="color: #d0d0d0">)</span></span>
<span id="L3" class="line">  <span style="color: #303030">left</span> <span style="color: #d0d0d0">/</span> <span style="color: #303030">right</span></span>
<span id="L4" class="line"><span style="color: #aa759f">end</span></span>
<span id="L5" class="line"></span>
<span id="L6" class="line"><span style="color: #505050"># 引数名を空白で二つ並べると、</span></span>
<span id="L7" class="line"><span style="color: #505050"># 一つ目が名前付き引数用の名前、二つ目が内部で使う引数の名前になる</span></span>
<span id="L8" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">even</span><span style="color: #d0d0d0">(</span><span style="color: #aa759f">if</span> <span style="color: #303030">cond</span><span style="color: #d0d0d0">)</span></span>
<span id="L9" class="line">  <span style="color: #303030">cond</span></span>
<span id="L10" class="line"><span style="color: #aa759f">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>このように名前付き引数を使ってメソッドを呼び出せます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 名前付き引数を指定</span></span>
<span id="L2" class="line"><span style="color: #303030">div</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">left: </span><span style="color: #90a959">1.0</span><span style="color: #d0d0d0">,</span> <span style="color: #90a959">right: </span><span style="color: #90a959">2.0</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; 0.5</span></span>
<span id="L3" class="line"><span style="color: #505050"># 順番を逆にして指定</span></span>
<span id="L4" class="line"><span style="color: #303030">div</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">right: </span><span style="color: #90a959">2.0</span><span style="color: #d0d0d0">,</span> <span style="color: #90a959">left: </span><span style="color: #90a959">1.0</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; 0.5</span></span>
<span id="L5" class="line"></span>
<span id="L6" class="line"><span style="color: #505050"># `cond` ではなく `if` を名前付き引数に指定する</span></span>
<span id="L7" class="line"><span style="color: #303030">even</span> <span style="color: #90a959">if: </span><span style="color: #aa759f">true</span> <span style="color: #505050"># =&gt; true</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="可変長引数">可変長引数</h3>
<div class="paragraph">
<p>Ruby 同様、引数名の前に <code>*</code> を置くと可変長引数を受け取るものとして、 <code>**</code> を置くと名前付き引数の余った引数を受け取るものとしてマークされます。</p>
</div>
<div class="paragraph">
<p>Ruby では可変長引数は配列を、キーワード引数の余りはハッシュを受け取ります。<br>
ですが、 Crystal では可変長引数ではタプル（ <code>Tuple</code> ） に、名前付き引数の余りは名前付きタプル（ <code>NamedTuple</code> ）になります。</p>
</div>
<div class="paragraph">
<p>タプルは配列に似ていますが、固定長・変更不可であり、各要素の型を保持しているのが特徴です。<br>
また名前付きタプルもキーがシンボルのハッシュに似た型で、タプルと同様に変更不可で各シンボルのキーに対応する型を保持しているのが特徴です。</p>
</div>
<div class="paragraph">
<p>splat 展開の際にも、これらを渡します。<br>
splat 展開も Ruby と同様の構文で、メソッド呼び出しで引数の前に <code>*</code> を置いたものが可変長引数の splat 展開となります。また、引数の前に <code>**</code> を置いたものは名前付き引数の splat 展開になります。</p>
</div>
<div class="paragraph">
<p>実際に可変長引数を受け取るメソッドの例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 可変長引数・名前付き引数の余りを受け取ってその型を返すメソッド</span></span>
<span id="L2" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">vararg_type</span><span style="color: #d0d0d0">(</span><span style="color: #d0d0d0">*</span><span style="color: #303030">tuple</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">**</span><span style="color: #303030">named_tuple</span><span style="color: #d0d0d0">)</span></span>
<span id="L3" class="line">  <span style="color: #d0d0d0">[</span><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #303030">tuple</span><span style="color: #d0d0d0">),</span> <span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #303030">named_tuple</span><span style="color: #d0d0d0">)]</span></span>
<span id="L4" class="line"><span style="color: #aa759f">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>この実行結果は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 可変長引数の場合</span></span>
<span id="L2" class="line"><span style="color: #303030">vararg_type</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">42</span><span style="color: #d0d0d0">,</span> <span style="color: #90a959">"str"</span><span style="color: #d0d0d0">)</span></span>
<span id="L3" class="line"><span style="color: #505050"># =&gt; [Tuple(Int32, String), NamedTuple()]</span></span>
<span id="L4" class="line"></span>
<span id="L5" class="line"><span style="color: #505050"># 名前付き引数の場合</span></span>
<span id="L6" class="line"><span style="color: #303030">vararg_type</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">foo: </span><span style="color: #90a959">42</span><span style="color: #d0d0d0">,</span> <span style="color: #90a959">bar: </span><span style="color: #90a959">"str"</span><span style="color: #d0d0d0">)</span></span>
<span id="L7" class="line"><span style="color: #505050"># =&gt; [Tuple(), NamedTuple(foo: Int32, bar: String)]</span></span>
<span id="L8" class="line"></span>
<span id="L9" class="line"><span style="color: #505050"># splat 展開</span></span>
<span id="L10" class="line"><span style="color: #303030">tuple</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">{</span><span style="color: #90a959">42</span><span style="color: #d0d0d0">,</span> <span style="color: #90a959">"str"</span><span style="color: #d0d0d0">}</span> <span style="color: #505050"># タプルのリテラルは配列の `{ }` 版</span></span>
<span id="L11" class="line"><span style="color: #505050"># 名前付きタプルはハッシュの `:` 区切り版</span></span>
<span id="L12" class="line"><span style="color: #303030">named_tuple</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">{</span></span>
<span id="L13" class="line">  <span style="color: #90a959">foo: </span><span style="color: #90a959">42</span><span style="color: #d0d0d0">,</span></span>
<span id="L14" class="line">  <span style="color: #90a959">bar: </span><span style="color: #90a959">"str"</span><span style="color: #d0d0d0">,</span></span>
<span id="L15" class="line"><span style="color: #d0d0d0">}</span></span>
<span id="L16" class="line"><span style="color: #303030">vararg_type</span><span style="color: #d0d0d0">(</span><span style="color: #d0d0d0">*</span><span style="color: #303030">tuple</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">**</span><span style="color: #303030">named_tuple</span><span style="color: #d0d0d0">)</span></span>
<span id="L17" class="line"><span style="color: #505050"># =&gt; [Tuple(Int32, String), NamedTuple(foo: Int32, bar: String)]</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="インスタンス変数の型">インスタンス変数の型</h3>
<div class="paragraph">
<p>Crystal ではインスタンス変数・クラス変数の型がコンパイル時に決定できなければいけません。</p>
</div>
<div class="paragraph">
<p><code>initialize</code> メソッドの中でインスタンス変数に代入している場合などは気を利かせて型を推論してくれます。<br>
しかし、そうでない場合は型が分からずにコンパイルエラーになることがあります。<br>
その場合は明示的にインスタンス変数の型を指定してください。</p>
</div>
<div class="paragraph">
<p>また、メソッドの引数名としてインスタンス変数を指定すると、メソッドの呼び出しと同時に、そのインスタンス変数に代入することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #aa759f">class</span> <span style="color: #f4bf75">Foo</span></span>
<span id="L2" class="line">  <span style="color: #505050"># 引数にインスタンス変数を指定すると、その変数に代入される。</span></span>
<span id="L3" class="line">  <span style="color: #505050"># 加えて、引数の型やデフォルト引数を指定すると、インスタンス変数の型が</span></span>
<span id="L4" class="line">  <span style="color: #505050"># その型に推論される。</span></span>
<span id="L5" class="line">  <span style="color: #aa759f">def</span> <span style="color: #303030">initialize</span><span style="color: #d0d0d0">(</span><span style="color: #303030">@foo</span> <span style="color: #d0d0d0">:</span> <span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">,</span> <span style="color: #303030">@bar</span> <span style="color: #d0d0d0">=</span> <span style="color: #90a959">"bar"</span><span style="color: #d0d0d0">)</span></span>
<span id="L6" class="line">    <span style="color: #505050"># こういう単純な代入の場合もインスタンス変数の型は推論される。</span></span>
<span id="L7" class="line">    <span style="color: #303030">@baz</span> <span style="color: #d0d0d0">=</span> <span style="color: #f4bf75">Array</span><span style="color: #d0d0d0">(</span><span style="color: #f4bf75">Int32</span><span style="color: #d0d0d0">).</span><span style="color: #303030">new</span></span>
<span id="L8" class="line">  <span style="color: #aa759f">end</span></span>
<span id="L9" class="line"></span>
<span id="L10" class="line">  <span style="color: #505050"># インスタンス変数に対するゲッターメソッドを定義</span></span>
<span id="L11" class="line">  <span style="color: #aa759f">getter</span> <span style="color: #303030">foo</span><span style="color: #d0d0d0">,</span> <span style="color: #303030">bar</span><span style="color: #d0d0d0">,</span> <span style="color: #303030">baz</span></span>
<span id="L12" class="line"><span style="color: #aa759f">end</span></span>
<span id="L13" class="line"></span>
<span id="L14" class="line"><span style="color: #303030">foo</span> <span style="color: #d0d0d0">=</span> <span style="color: #f4bf75">Foo</span><span style="color: #d0d0d0">.</span><span style="color: #303030">new</span> <span style="color: #90a959">42</span></span>
<span id="L15" class="line"></span>
<span id="L16" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #303030">foo</span><span style="color: #d0d0d0">.</span><span style="color: #303030">foo</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Int32</span></span>
<span id="L17" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #303030">foo</span><span style="color: #d0d0d0">.</span><span style="color: #303030">bar</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; String</span></span>
<span id="L18" class="line"><span style="color: #303030">typeof</span><span style="color: #d0d0d0">(</span><span style="color: #303030">foo</span><span style="color: #d0d0d0">.</span><span style="color: #303030">baz</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Array(Int32)</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="struct"><code>struct</code></h3>
<div class="paragraph">
<p><code>class</code> とよく似たものとして <code>struct</code> があります。</p>
</div>
<div class="paragraph">
<p><code>struct</code> も <code>class</code> とほぼ同等の機能を持っていますが、メモリ確保に違いがあります。<br>
<code>class</code> で定義した型のインスタンスはヒープに置かれますが、 <code>struct</code> はスタックに置かれます。<br>
このため <code>struct</code> の方が高速にインスタンスを作ることができます。</p>
</div>
<div class="paragraph">
<p>しかし、 <code>struct</code> は自分自身をインスタンス変数に持つことができないという制約があります。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enum"><code>enum</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Crystal には <code>enum</code> があります。<br>
これは連番の数値型に分かりやすい名前を付けたもので、さらにメソッドを定義することもできます。</p>
</div>
<div class="paragraph">
<p>そして、 <code>@[Flags]</code> 属性を付けると、単なる連番ではなく値はビットフラグになります。</p>
</div>
<div class="paragraph">
<p>また、<code>enum</code> にはオートキャストという機能もあります。引数の型制約に <code>enum</code> を指定して、シンボルが渡されたときに、自動でシンボルから <code>enum</code> へ変換するというものです。シンボルが <code>enum</code> として有効な値かどうかはコンパイル時にチェックされるので、普通にシンボルを使う場合よりも安全です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># 色を表す `enum` を定義</span></span>
<span id="L2" class="line"><span style="color: #303030">enum</span> <span style="color: #f4bf75">Color</span></span>
<span id="L3" class="line">  <span style="color: #f4bf75">Red</span></span>
<span id="L4" class="line">  <span style="color: #f4bf75">Green</span></span>
<span id="L5" class="line">  <span style="color: #f4bf75">Blue</span></span>
<span id="L6" class="line"></span>
<span id="L7" class="line">  <span style="color: #505050"># 値を直接指定することもできる</span></span>
<span id="L8" class="line">  <span style="color: #f4bf75">Yellow</span> <span style="color: #d0d0d0">=</span> <span style="color: #90a959">100</span></span>
<span id="L9" class="line"><span style="color: #aa759f">end</span></span>
<span id="L10" class="line"></span>
<span id="L11" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">color_name</span><span style="color: #d0d0d0">(</span><span style="color: #303030">color</span> <span style="color: #d0d0d0">:</span> <span style="color: #f4bf75">Color</span><span style="color: #d0d0d0">)</span></span>
<span id="L12" class="line">  <span style="color: #303030">color</span></span>
<span id="L13" class="line"><span style="color: #aa759f">end</span></span>
<span id="L14" class="line"></span>
<span id="L15" class="line"><span style="color: #505050"># ファイルの開く際にモードを表す `enum` を定義</span></span>
<span id="L16" class="line"><span style="color: #303030">@[Flags]</span></span>
<span id="L17" class="line"><span style="color: #303030">enum</span> <span style="color: #f4bf75">FileMode</span></span>
<span id="L18" class="line">  <span style="color: #f4bf75">Read</span></span>
<span id="L19" class="line">  <span style="color: #f4bf75">Write</span></span>
<span id="L20" class="line"><span style="color: #aa759f">end</span></span>
<span id="L21" class="line"></span>
<span id="L22" class="line"><span style="color: #505050"># `enum` は定数と同じように `::` で参照する。</span></span>
<span id="L23" class="line"><span style="color: #f4bf75">Color</span><span style="color: #d0d0d0">::</span><span style="color: #f4bf75">Red</span> <span style="color: #505050"># =&gt; Red</span></span>
<span id="L24" class="line"></span>
<span id="L25" class="line"><span style="color: #505050"># オートキャストが発動して、 `:green` が `Color::Green` に変換される。</span></span>
<span id="L26" class="line"><span style="color: #303030">color_name</span><span style="color: #d0d0d0">(</span><span style="color: #90a959">:green</span><span style="color: #d0d0d0">)</span> <span style="color: #505050"># =&gt; Green</span></span>
<span id="L27" class="line"></span>
<span id="L28" class="line"><span style="color: #505050"># `@[Flags]` のついた `enum` は `|` で複数指定できる。</span></span>
<span id="L29" class="line"><span style="color: #f4bf75">FileMode</span><span style="color: #d0d0d0">::</span><span style="color: #f4bf75">Read</span> <span style="color: #d0d0d0">|</span> <span style="color: #f4bf75">FileMode</span><span style="color: #d0d0d0">::</span><span style="color: #f4bf75">Write</span> <span style="color: #505050"># =&gt; Read | Write</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="メソッド呼び出し">メソッド呼び出し</h2>
<div class="sectionbody">
<div class="paragraph">
<p>メソッド呼び出しの構文はほとんど Ruby と同じですが、1つだけ異なる点があります。</p>
</div>
<div class="paragraph">
<p>Crystal には一引数ブロックの省略記法というものがあります。<br>
これは ブロックの第一引数に対してメソッドを呼び出す場合に <code>&amp;.メソッド名</code> のように書けるという構文です。<br>
さらに、そこからメソッドチェインを始めることができるため、場合によってはとても便利です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #505050"># `42` を `yield` するメソッド</span></span>
<span id="L2" class="line"><span style="color: #aa759f">def</span> <span style="color: #303030">yield_42</span></span>
<span id="L3" class="line">  <span style="color: #aa759f">yield</span> <span style="color: #90a959">42</span></span>
<span id="L4" class="line"><span style="color: #aa759f">end</span></span>
<span id="L5" class="line"></span>
<span id="L6" class="line"><span style="color: #303030">yield_42</span> <span style="color: #d0d0d0">{</span> <span style="color: #d0d0d0">|</span><span style="color: #303030">x</span><span style="color: #d0d0d0">|</span> <span style="color: #303030">x</span><span style="color: #d0d0d0">.</span><span style="color: #303030">to_s</span><span style="color: #d0d0d0">.</span><span style="color: #303030">size</span> <span style="color: #d0d0d0">}</span> <span style="color: #505050"># =&gt; 2</span></span>
<span id="L7" class="line"><span style="color: #505050"># ↑を次のように書き直せる</span></span>
<span id="L8" class="line"><span style="color: #303030">yield_42</span> <span style="color: #d0d0d0">&amp;</span><span style="color: #d0d0d0">.</span><span style="color: #303030">to_s</span><span style="color: #d0d0d0">.</span><span style="color: #303030">size</span> <span style="color: #505050"># =&gt; 2</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="条件分岐繰り返し">条件分岐・繰り返し</h2>
<div class="sectionbody">
<div class="paragraph">
<p>条件分岐・繰り返しの構文は Ruby とほとんど同じです。<br>
ただし <code>redo</code> はありません。</p>
</div>
<div class="paragraph">
<p>条件分岐の条件に変数が対象になっている場合、その変数の型がフィルタされます。</p>
</div>
<div class="paragraph">
<p>例えば、次のコードを考えてみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-crystal" data-lang="crystal"><span id="L1" class="line"><span style="color: #303030">foo</span> <span style="color: #d0d0d0">=</span> <span style="color: #303030">rand</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #90a959">0.5</span> <span style="color: #d0d0d0">?</span> <span style="color: #90a959">"foo"</span> <span style="color: #d0d0d0">:</span> <span style="color: #aa759f">nil</span></span>
<span id="L2" class="line"></span>
<span id="L3" class="line"><b class="conum">(1)</b></span>
<span id="L4" class="line"><span style="color: #aa759f">if</span> <span style="color: #303030">foo</span></span>
<span id="L5" class="line">  <b class="conum">(2)</b></span>
<span id="L6" class="line"><span style="color: #aa759f">else</span></span>
<span id="L7" class="line">  <b class="conum">(3)</b></span>
<span id="L8" class="line"><span style="color: #aa759f">end</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>foo</code> の型は <code>String | Nil</code></p>
</li>
<li>
<p>この位置に来たら <code>foo</code> は確実に <code>String</code> 型</p>
</li>
<li>
<p>この位置に来たら <code>foo</code> は確実に <code>Nil</code> 型</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ということが分かると思います。</p>
</div>
<div class="paragraph">
<p>このように、条件分岐の条件によって、ブロック内で変数の型がいい感じに変化するのです。</p>
</div>
<div class="paragraph">
<p>型のフィルタに使える特殊な構文には次のものがあります。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>is_a?</code> </dt>
<dd>
<p><code>foo.is_a?(String)</code> は変数 <code>foo</code> が <code>String</code> 型のとき <code>true</code> になります。</p>
</dd>
<dt class="hdlist1"><code>nil?</code> </dt>
<dd>
<p><code>is_a?(Nil)</code> の省略形です。</p>
</dd>
<dt class="hdlist1"><code>responds_to?</code> </dt>
<dd>
<p><code>foo.responds_to?(:size)</code> は変数 <code>foo</code> がメソッド <code>size</code> を持っているときに <code>true</code> になります。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>ちなみにこれらの構文はメソッドのような見た目ですがメソッドではないため、オーバライドなどはできないことに注意してください。</p>
</div>
<div class="paragraph">
<p>また、これらを <code>&amp;&amp;</code> や <code>||</code> や <code>!</code> で組み合わせたものも動作します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="まとめ">まとめ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>説明しなかった構文はいくつもありますが、この辺りの構文を覚えておけば Crystal のソースコードがそれなりに読めるようになるはずです。</p>
</div>
<div class="paragraph">
<p>説明しなかったのは、</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ジェネリックスの構文</p>
</li>
<li>
<p>C言語と連携のための構文</p>
</li>
<li>
<p>マクロ</p>
</li>
<li>
<p>アノテーション</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>などです。<br>
これらは高度な機能なので、当分は知らなくても問題がないでしょう。</p>
</div>
<div class="paragraph">
<p>ちなみに、マクロについては次の章で詳しく解説されるはずです。</p>
</div>
<div class="paragraph">
<p>また、分からない構文はあれば最初に挙げた Crystal のドキュメントを確認してみるといいでしょう。<br>
これよりも詳細に書かれているはずです。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Syntax and Semantics </dt>
<dd>
<p><a href="https://crystal-lang.org/docs/syntax_and_semantics/" class="bare">https://crystal-lang.org/docs/syntax_and_semantics/</a></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>加えて、 標準ライブラリの API ドキュメントは以下にあります。<br>
知らない型やメソッドが出てきたときに確認してみてください。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">API ドキュメント </dt>
<dd>
<p><a href="https://crystal-lang.org/api/" class="bare">https://crystal-lang.org/api/</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div></div>
	</article>
</div><!-- Footer -->
<div id="footer">
  
  <!-- Copyright -->
  <ul class="copyright">
    
      <li>&copy;Introducing Crystal Programming Language. All rights reserved.</li>
    
    <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
    <li>Jekyll integration: <a href="https://chrisbobbe.github.io/">Chris Bobbe</a></li>
  </ul>
  
</div></body>
</html>